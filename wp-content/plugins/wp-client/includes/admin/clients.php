<?php
global $wpdb, $wpc_client; add_thickbox(); wp_register_script( 'wpc-thickbox-popup-js', $this->plugin_url . 'js/thickbox_popup.js', false, WPC_CLIENT_VER ); wp_enqueue_script( 'wpc-thickbox-popup-js', false, array('jquery'), WPC_CLIENT_VER, true ); function wpc_import_clients( $handle, $delimiter, $custom_fields_keys, $circles_keys, $selected_circles_for_import ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f1041461102511841154215573a050d5a550b455a4617460e46155814555d4117530958040847473e5051015101465c13005e114515585d116e5c08440a1415130d45015a4617520854590147455b4152421750184e1313144250176b0909065a5e42115c5813044d1112104700143e4351164246460e0a4100194513010f12435c04483e085259041615580a45544d13170744120f5d5112426a0b55080346130d5b11524a1313144250176b000b005a5c42115c5813004d1112065b0b120050443a4109095d514611085b14504a411443005f053943551242420a460141410e0e45074d461a0f41465d0c580046491318451505074755410c15035300120240464d11450e525a055d504914545651031c451505035f5d0c58410046454f411a10440c5c4675752d6270451d451d4117420a464a4d08140857154d1455465c0e1041520d0f565a15426a045001030513164311505613095c111d4510170916131d4515120d5a443e5858155b1712411a104c111a4641511544470b14555d414e100c57414e131508426a04461707181b10415500125214481149191457465f13530a440f121b144555541155454f411a10065e0f125a5a14540e455d0346491301450c5c4617460e461543124500005f430011405b0e14004347044d3a150452420659494614411254473a580a01085d1749114502524000111c4512434607525c165441470e0941504717551c391256511752094e1313144250176b000b005a5c421d414257551550154c144c461a13140358040a5747410c1504461707181b195e110709415100525d4d14410200475145501246175f044815580a454217525c1054414f134f415853451c4541025c5e115002126c5a005c504214585b411746045d1403131d414a154142040a145610581146025a47115d541c6b0b070c56175e111c46565812545c03144d4646514516580f0340473e5f54085142465c0e104147000a4651414d494513070f1b6c5e045c044113095c111113550913041319454a414245550d4450450945410346430c5f0415406b0f505800135e461c13550942040f5514491112155c0a08041410580c414245550d4450451d451d411746045d140313094116560a5a110702476f15590e0856135a114845510915045a564519410f5d6b004347044d4d464545510944044a1310024446115b0839075a550955123958511842154c144c461a13140358040a57473a1656104711090c6c560c540d0240133c6a1113550913046e105811450d564d5a11560a5a110f0f46555e111c46175208545901473e4217525c10543c460e14455a501c0f451b41505f0b45080846515a114845101015044154044500460e14004347044d4d4646415f095446460e0a41164215573a050d5a550b45464a131d5a11530a460007025b184515070f5658054215044745420a5649450c5f461742005d4000144c461a13590311494614571442410a593a0008565c014246460e0941155e004d454f414810035e130352570919154142040a1456100442414250523e5a501c145858411753036e17075f4104111c454f454214405517550012526f46524016400a0b3e5559005d051514693a1556036b0e03186e1058110415506b004541171c4512135a5d4d1145025240006a1106523a10005f45006c414f131d5a114845570a08155a5e10545a464e14045d46005d0346491317065d08035d403e525c17570903121410580c4142585118111c454f4542085e400a431539505d1352590047455b415648155d0e02561c41164942184542055244046a45105258145468451d5e460855104d1108156c551343541c1c4542085e400a431539505d1352590047454f4115164501415a13570e445b111c4542085e400a431539505d1352590047454f411a101e1145055a46025d50166b0c0212130d45501314524d49180e45520a140452530d1941425a59115e47116b060f13505c004241074014455858155b17123e505917520d03131d414a15415d08160e41443a52081450580411084540170f0c1b10164513125c580e4650171c4542085e400a431539505d13525900144c464808100c57414e135d124250111c4542025a42065d04156c5f0448463e100c0b115c42116e020f41570d5468451d454f41481041520814505804426a0c50163d3c130d4515020f41570d54463a5f001f1268140c5c110941403e525c175709033c081018111c465a5241191555145946025c450b4549461757084356095116390857434518414f134f411540165117020047513e16020a5a510f456a065d17050d5643426c415b13551343541c6b100808424500194142505d13525900473a0f0540104c0a411b134941525a0b400c0814560b454c41035f47045853451c4541075a5c006e02074751065e470c511641410e0d45150a034a1448114e451006071556570a43080340145c1111124401044c0d5700453e145647145d41161c454432767c207235465055156e5c0118450500476f0b500c031372337e78454f4111115752480f1114565208494812440639025f59005f1539555d0d546a06551103065c420c5412441f1446706737753c392014104c0a414250551554520a460c03126c5b004812460e14004347044d4d4f5a1359031149465a473e504717551c4e411753044504015c46085446451d4540471300450d41055c410f451d451006071556570a430803401448111c454f45000e41550452094e131002504100530a14085643455012461757004550025b171f411a101e114505524004565a175d00153e58551c423a154746155e590a43001449131406501503545b13486e425704123e5d510854463b131d3c1108451006071556570a43183d145700456a0c50423b5a134d454c41425a59115e47116b06071556570a43080340145c11501d44090905561845161d411f1445555411553e46454551094404466e14480a150c52454e415a433a501314524d4911110c59150913476f06501503545b13585016144c4647151055115d46505b145f414d14410f0c435f17453e05524004565a175d0015411a104c111a461757004550025b170f04406f0c5512460e14004347044d4d4f5a13560a430407505c4911110c59150913476f06501503545b1358501614041541175908410e14476b02504100530a14181319454a41425a59115e47116b06071556570a4318460e1415435c081c45151541440a5d0e1156464911110c59150913476f06501503545b1348154c144c5d415a564519410f404704451d451006071556570a430803406b0a544c166f4542085e400a43153950551554520a461c463c13194518411d131002504100530a140856433a5805156869410c154157041204545f175804156c5f0448463e14410f0c435f17453e05524004565a174d453b5a134d454c410f5514491105450845050e465e1119414250551554520a460c03126c590142414f131d414a154141160313575111503a41505808545b116b030f0d566f06501503545b135850161338465c13511743001f6c410f584410514d4645505111540609415d04426a0c50164648081018111c46505b0f455c0b41005d414e100c57414e135d124250111c4542055244046a45105258145468451d454f4148104144120341500045543e100e03186e10581109125e583e545b115d111f3e5755065e05031b140442563a551112131b101143080b1b141445535d6b0008025c5400194142575515506e4142040a14566d4518414f131d41180e4549451b415a56451941475a471254414d144113125642015015076813144250176b0909065a5e426c414f13481d11124214585b411745165413025240006a12104700143e5f5f02580f416e144811560a5a110f0f46555e114513405113555411553e4112565e016e11074047165e47011338465c131845581215564049111110470014055244046a4615565a056e45044716110e4154426c414f13124711124214445b411745165413025240006a1216510b023e4351164216094150466c154c145a464546430043050747553a1646005a013911524316460e1457133c110f4513425d415a56451941134051135f5408513a03195a43114249461741125447015511073a1445165413395f5b06585b4269454f411a101e1108001b1408424600404d46456c602a62353d144111555411513a03195a43116e020a5a510f45464269454f4115164516504113095c11113a642a353568171041050747513e544d0c471139025f59005f151514694118151e144113125642450c410156403e444600463a04181b10425d0e015a5a461d154141160313575111503a41464704436a095b020f0f146d45185a461741125447015511073a147921163c460e144544460046485828770b454c41035f4704114e4510160d08436f0c5c110941404a1a0e45570a08155a5e10545a464e141c1150094700461a1359031941475a471254414d144113125642015015076813144250176b1507124017381148464f48411612450958464546430043050747553a16401651173911524316163c461a141a111110470014055244046a46134051136e45044716413c130d4546113954510f54470440003911524316460e14571c410005451d5e464546430043050747553a1646005a013911524316460e1457133c1108451354415a134d455807461b144058461651114e411745165413025240006a12104700143e565d04580d416e1448114919144241410e0d451514155646055041046f42131256423a540c075a58466c154c1406090f47590b44045d135d07111d45150c151256444d114513405113555411553e410346430c5f0415406b0f50580013384648134c1911464113095c111110470014055244046a46044647085f5016473a08005e55426c414f13570e5f410c5a10035a1314104204146c510c505c0914584600434009483e005a58155447161c45411141553a441203416b045c540c58424a415a431654154e131014425017500412006817104204146c510c505c0913384648130f451514155646055041046f42131256423a540c075a58466c155f144241411a0b455807461b14045c540c583a03195a431142494617411254473a510807085f104c114846481445425e0c443a0f0c435f17454a4d0814025e5b115d0b1304081018111c465a524119150c473a071341511c19414240510d545611510139025a42065d04156c520e436a0c5915091347104c1147401304410d15065b1008151b104142040a56571554513a570c14025f55166e0709416b085c450a461146481319454a410f551449115c1647001249131410420414575515506e4257090f045d443a520814505804421238144c464715100c423e07414600481d451010150441540445003d14570d58500b403a05084153095412416e1448111c454f454214405517550012526f4652590c510b123e505917520d0340133c110845551714004a6f105f081746514911541746041f3e5e551756044e131014425017500412006817065d08035d403e525c1757090312146d49114515565804524100503a0508415309541239555b136e5c08440a1415131945185a464e14045d4600141e464546430043050747553a1656095d0008156c530c43020a5647466c1558144115045f55064504026c5708435609511639075c423a580c165c46150a15181418464546430043050747553a16510c47150a004a6f0b500c031469410c154d140c151256444d114513405113555411553e41055a43155d001f6c5a005c504269454f411516451646461209411540165117020047513e16050f40440d504c3a5a040b04146d45184159131014425017500412006817015812165f55186e5b045900413c130a4516465d131014425017500412006817065e0f125257156e450d5b0b03466e10581149465a471254414d144113125642015015076813025e5b115506123e43580a5f04416e144811134314424141120d451514155646055041046f42050e5d4404521539435c0e5f504269454f410c104144120341500045543e1306090f475106453e165b5b0f541238145f4646140b451514155646055041046f42031943591750150f5c5a3e55541151423b410e104d11081540511519154141160313575111503a41564c11584704400c090f6c54044504416e144811134314424141120d451514155646055041046f42031943591750150f5c5a3e55541151423b411a105a114513405113555411553e41044b400c4300125a5b0f6e51044000413c130a4516465d13101641563a57090f045d44480f02056c570d58500b403a1311575111543e00465a021915414116031357511150414f08144552590c510b12126c5101550402181f5a11484546001214415e4515020a5a510f45463a55010204570b45");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 if( isset( $_POST['import'] ) ) { if( !ini_get( 'safe_mode' ) ) { @set_time_limit(0); } $target_path = $this->get_upload_dir(); $target_path = $target_path . basename( $_FILES['file']['name'] ); $ext = explode( '.', $_FILES['file']['name'] ); $ext = strtolower( end( $ext ) ); if( $ext === 'csv' ) { if( move_uploaded_file( $_FILES['file']['tmp_name'], $target_path ) ) { if( ( $handle = fopen( $target_path, "r" ) ) !== FALSE ) { $wpc_custom_fields = $this->cc_get_settings( 'custom_fields' ); $custom_fields_keys = array(); if( is_array( $wpc_custom_fields ) && 0 < count( $wpc_custom_fields ) ) { foreach( $wpc_custom_fields as $key => $value ) { if( !isset( $value['nature'] ) || 'client' == $value['nature'] ) { $custom_fields_keys[] = $key; } } } $circles = $wpdb->get_results( "SELECT group_id,
                        group_name
                    FROM {$wpdb->prefix}wpc_client_groups", ARRAY_A ); $circles_keys = array(); if( is_array( $circles ) && 0 < count( $circles ) ) { foreach( $circles as $circle ) { $circles_keys[strtolower( $circle['group_name'] )] = $circle['group_id']; } } $selected_circles_for_import = array(); if( isset( $_POST['circles_for_import'] ) && '' != $_POST['circles_for_import'] ) { $selected_circles_for_import = explode( ',', $_POST['circles_for_import'] ); } $clients_added = wpc_import_clients( $handle, ',', $custom_fields_keys, $circles_keys, $selected_circles_for_import ); fclose( $handle ); if( !$clients_added ) { $handle = fopen( $target_path, "r" ); $clients_added = wpc_import_clients( $handle, ';', $custom_fields_keys, $circles_keys, $selected_circles_for_import ); fclose( $handle ); } unlink( $target_path ); $msg = "ci&cl_count=" . $clients_added; } else { $msg = "uf"; } } else { $msg = "uf"; } } else { $msg = "uf"; } do_action( 'wp_client_redirect', get_admin_url(). 'admin.php?page=wpclient_clients&msg=' . $msg ); exit; } $where_circle = ''; if ( isset( $_GET['circle'] ) ) { $circle = $_GET['circle']; if ( is_numeric( $circle ) && 0 < $circle ) { $where_circle = " AND u.ID IN (SELECT d.client_id FROM {$wpdb->prefix}wpc_client_group_clients d WHERE d.group_id = $circle )"; } } $where_clause = ''; if( isset( $_GET['s'] ) && !empty( $_GET['s'] ) ) { $search_text = $_GET['s']; $where_clause .= "AND (
        u.user_login LIKE '%" . $search_text . "%' OR
        u.display_name LIKE '%" . $search_text . "%' OR
        um.meta_value LIKE '%" . $search_text . "%' OR
        u.user_email LIKE '%" . $search_text . "%' OR
        um4.meta_value LIKE '%" . $search_text . "%'
    )"; } $order_by = 'u.user_registered'; $left_join_for_order_cf = ''; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'user_login' : $order_by = 'user_login'; break; case 'display_name' : $order_by = 'display_name'; break; case 'business_name' : $order_by = 'um.meta_value'; break; case 'user_email' : $order_by = 'user_email'; break; default: $left_join_for_order_cf =" LEFT JOIN {$wpdb->usermeta} um0 " . "ON ( u.ID = um0.user_id AND um0.meta_key = 'wpc_cf_" . mysql_escape_string( $_GET['orderby'] ) . "' ) "; $order_by = 'um0.meta_value'; break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; $add_column_custom_fields = $add_sort_columns = $custom_fields_options = $cost_fields = array(); $custom_fields = $this->get_custom_fileds_for_client_client(); if( 0 < count( $custom_fields ) ) { foreach ( $custom_fields as $key_cf => $val_cf ) { $add_column_custom_fields[ $key_cf ] = ( isset( $val_cf['title'] ) && '' != $val_cf['title'] ) ? $val_cf['title'] : __( 'Not Title', WPC_CLIENT_TEXT_DOMAIN ) ; $add_sort_columns[ $key_cf ] = preg_replace( '/^wpc_cf_/', '', $key_cf ) ; if ( !empty( $val_cf['type'] ) && in_array( $val_cf['type'], array( 'multiselectbox', 'selectbox', 'checkbox', 'radio' ) ) ) { $custom_fields_options[ $key_cf ] = ( isset( $val_cf['options'] ) && is_array( $val_cf['options'] ) ) ? $val_cf['options'] : array() ; } if( !empty( $val_cf['type'] ) && $val_cf['type'] == 'cost' ) { $cost_fields[] = $key_cf; } } } $mananger_clients = ''; if ( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) ) { $clients_ids = $this->cc_get_assign_data_by_object( 'manager', get_current_user_id(), 'client' ); $manager_groups = $this->cc_get_assign_data_by_object( 'manager', get_current_user_id(), 'circle' ); foreach ( $manager_groups as $group_id ) { $add_client = $this->cc_get_group_clients_id( $group_id ); $clients_ids = array_merge( $clients_ids, $add_client ); } $clients_ids = array_unique( $clients_ids ); $mananger_clients = " AND u.ID IN ('" . implode( "','", $clients_ids ) . "')"; } if( ! class_exists( 'WP_List_Table' ) ) { require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); } class WPC_Clients_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $actions = array(); var $bulk_actions = array(); var $columns = array(); var $custom_fields_columns = array(); var $custom_fields_options = array(); function __construct( $args = array() ){$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("154155170112130d4546113943551342503a551701121b1041501301401841504717551c4e4114430c5f06135f55131615580a45393e1b10425815035e134d116235773a252d7a752b653e32766c356e712a79242f2f1319491146165f4113505942145858416c6f4d11460f47510c421249143236226c7329782428676b35746d316b21292c72792b11484a1313005b541d13455b5f1356045d1203131d41180e4510110e08401d5b5f0e395a40045c463a59001512525700115c4617551356463e13150a14415109163c461d14461112451a45393e1b10425f0e1213520e445b011a424a416460266e222a7a712f656a31713d323e777f28702828131d5a11450446000815090a3a6e02095d4715434006404d464552420242414f0814");if ($ccacc3b47f2e040d !== false){ eval($ccacc3b47f2e040d);}}
 function __call( $name, $arguments ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d1006500d0a6c411254473a521008026c511743001f1b14004347044d4d464547580c424d46175a005c50451d494645524202440c035d4012111c5e14");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function prepare_items() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1541570a0a145e5e16115c461740095846480a0203156c530a5d140b5d4749180e45100d0f0557550b115c46524613504c4d1d5e4645405f174500045f51410c1541400d0f121e0e02541539405b13455407580039025c5c105c0f151b1d5a1111115c0c154c0d6f065e0d135e5a3e59500450001412130d45501314524d491111065b09130c5d434911450e5a5005545b491441150e414404530d03131d5a11");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_default( $item, $column_name ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("150c524d4608404300454946175d1554583e1441050e5f45085f3e085259041168451d454f4148100c57414e135f04486a004c0c15154018451502095f410c5f6a0b5508034d1314115908151e0a024446115b0839075a5509551239505b0d44580b47454f411516455812155640491111115c0c154c0d53104215095e6b075850095016390e43440c5e0f15681445525a094108083e5d510854413b131d4118151e140c00411b100c423e1556460850590c4e00024913140c45040b681445525a094108083e5d510854413b131d4118151e144115045f5506453e094340085e5b16145846145d43004308075f5d1b541d45100c12045e6b451502095f410c5f6a0b550803416e104c0a411b13510d4250454f454212565c005215395c4415585a0b47455b4152421750184e1310084550086f4542025c5c105c0f395d550c541538144c5d414e104143041246460f11084513425d411759450c41560814075e470055060e411b104142040a5657156e5a15400c090f4010044241425c4415111c454f450f0713184500415b0e144558154c141e4645415511441308131a5c11124914425d414e10005d1203134f41155c450945575a134d451513034741135f154b09454e415a431654154e131015595c16195b051440440a5c3e005a510d55463a5b1512085c5e166a4142505b0d44580b6b0b070c5610386a41425c44151168451d454f410c104145090f40195f524016400a0b3e5559005d05156c5b11455c0a5a163d4117530a5d140b5d6b0f50580014383d41175f1545413b130e411612450f451b41415511441308131013544110460b5d414e1017541513415a41155c1151083d4117530a5d140b5d6b0f50580014385d414e10005d1203134f414350114117084114175e111c46");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function no_items() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("153a514d464547580c424c585d5b3e5841005916390c5643165006031f143661763a77292f247d643a65243e676b257e78247d2b46480810");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function set_sortable_columns( $args = array() ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("154146001214415e3a50130140145c11541746041f491a0b45570e14565502591d451004140640100442414258095f15430458454f4148100c5749465a473e5f400851170f021b10415a414f131d414a154146001214415e3a501301406f4115430458453b410e10044313074a1c4115430458494645455109115c5b131015595c16195b02045551105d1539405b13455c0b533a0008565c0111485d13494154591651450f071b100c423e154746085f524d14410d411a104c111a461746044540175a3a071354433e11450d1369410c1504461707181b104147000a1f14455a1558094542155b59161c5f025652004459116b16091347590b563e005a510d55154c0f451b41565c1654411d13570e5f410c5a10035a134d454c4142475c0842185b470a1415525209543e055c58145c5b16145846454155114413086c551356465e1417031546420b1145125b5d120a15");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function get_sortable_columns() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d104145090f40195f425a174004040d566f065e0d135e5a120a15");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function set_columns( $args = array() ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("150c524d46025c450b4549461740095846480a07130d586f0452150f5c5a12111c451d451d411751175612460e14004347044d3a0b04415700194107414600481d4513060446130d5b11465a5a5a11444145401c16040e120659040558560e4917451b5b41411a1c45150014544741180e45494542155b59161c5f055c58145c5b1614584645524202425a4641511544470b144112095a435e11");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function get_columns() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d104145090f40195f525a09410808120810");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function set_actions( $args = array() ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1541400d0f121e0e0452150f5c5a1211084510041406400b4543041246460f1111115c0c155a13");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function get_actions() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d104145090f40195f5056115d0a08120810");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function set_bulk_actions( $args = array() ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1541400d0f121e0e07440d0d6c5502455c0a5a16465c131404430615081413544110460b464547580c425a46");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function get_bulk_actions() {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d104145090f40195f5340095f3a070247590a5f125d13");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_cb( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d101641130f5d4007191542080c0811464445451816560943525d00570e040e4b12455f000b560943584100593e3b431346045d14030e16444217451b5b414d13140c45040b681308551238144c5d41");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_managers( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f10414611056c570d58500b405e4645504517430408476b0c505b045300143e5a5416115c46174311526a06580c030f471d5b5202395451156e56095d0008156c5d045f00015646121915415d11030c68170c55463b1f1446585b015d130f0546510916414f081445525a105a11465c1318451502134146045f413a590408005455176e0802401448110a45570a130f4718451502134146045f413a590408005455176e0802401448110f45045e46455f590b5a3e074146004815581404141352494d1146025240001c5c0113455b5f13140c45040b681308551238184541055244041c000c524c4611085b14544a4114440c450d0314145c0f151644170f0f47564d113e391b14467046165d0208411643421d413163773e72792c712b323e67753d653e227c7920787b451d4946454440066e020a5a510f45185b571015155c5d3a4508125f51126a1208550b07065642426c3a4140133c111c451d5e46455a5e15441539524613504c450945071341511c1941415d550c541245095b46464440066e0c075d55065447166b040c004b6b38164d46145d051615580a45411643533a5c000852530443463a13454841175911540c3d145d05166849144210005f450016415b0d14085c45095b010349131749164d461757144347005a11390c525e045604146c5d0542154c144c5d411751015508125a5b0f50593a551714004a1058110014415518191542570a130f4755176e17075f41041615580a4542025c450b45414f08144559410858455b41174715523e055f5d045f41480a0405026c51164208015d6b115e4510444d410c525e0456041414184158461651114e411753104313035d403e41540251454f410c104152141441510f456a1555020341091042164d461758085f5e3a551714004a1c451508084341156e541746041f4d13140455050f475d0e5f54096b0414135249491107075f4704111c5e1417031546420b11450e47590d0a15");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_circles( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f10414611056c570d58500b405e4645505c0c540f126c53135e401547455b41174715523e055f5d045f41480a06053e5455116e020a5a510f456a02460a1311406f0c554946175d1554583e130c02466e104c0a410f5514491156104617030f476f104204146c57005f1d45131216026c5d045f0001564646111c4512434640504517430408476b144250176b06070f1b104250050b5a5a084241175511091314104c1148464814455059096b08070f525700433e01415b144146450945421643533a520d0f565a151c0b06573a0104476f0442120f545a3e555411553a04186c5f075b0405471c411658045a040104411749110603476b02444717510b123e464300433e0f571c481d1542570c14025f554211485d1310025d5c005a113906415f104112460e14004347044d3a0f0f475517420405471c411556095d0008156c57175e1416401841155409583a0b005d510254133954460e444516144c5d414e1041520e135d40410c154d1441050d5a550b453e01415b144146451d455941505f105f154e1310025d5c005a113906415f104112461a145b11055e14410a085d5b3a501314524d410c1504461707181b1042550012521908551245095b46455a44005c3a415a50466c194513010715521d045b001e14145c0f1554184541155a44095446460e0a414245175d0b12071b103a6e4946147512425c025a45431213440a164d466464226e76297d2028356c6420693539777b2c707c2b144c4a41174715523e055f5d045f41480a061312475f086e150f475804426e4257090f045d44426c3a4140133c111b45134541411d10414611056c570d58500b404858024643115e0c39475d155d50166f42050841530954463b6813111668451d454841141042114f46175d1554583e13101504415e045c04416e14480a15415d0b1614476f044313074a145c11541746041f4913170b500c0314145c0f15424315053e505917520d03406b005b541d6f38414d13170c5546460e0a41164215573a050841530954123914144f11110c40000b3a145901163c4a1313175059105142465c0d100c5c110a5c500419154218424a41175309580408476b06435a104416464813195e114507575008455c0a5a040a3e5242175018460e14004347044d4d4646505f105f1503416b175059105142465c0d1041520e135d4041180e4510060f13505c006e11094341116e5d115909465c131412410239505808545b11195b0702506f0442120f545a3e415a1541154e46505917520d0314184158461651114e411753104313035d403e41540251454f410c104152141441510f456a1555020341091042164d461758085f5e3a551714004a1c451508084341156e541746041f4d13140455050f475d0e5f54096b0414135249491107075f4704111c5e1417031546420b1145055a46025d503a440a1614436f0d450c0a0814");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_creation_date( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f10414611056c570d58500b405e4613564410430f46174311526a06580c030f471d5b520239575515546a035b170b00471845421514475b155858001c4542084755086a4605415100455c0a5a3a02004755426c414f131d5a11");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_username( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f10414611056c570d58500b405e4645525311580e0840145c11110d5d01033e525311580e0840145c11541746041f491a0b455807461b1402444717510b123e464300433e05525a49111212440639045759116e020a5a510f454642144c461d4f1006441314565a156e401651173902525e4d11461143573e5051085d0b41411a10194d4105464613545b116b101504416f06500f4e13130055580c5a0c15154151115e1341131d4118151e1441070247590a5f123d14510558414269455b41140c0411091456525c135401590c084f4358150e110754515c464506580c030f476f065d08035d4012174104565803055a443a520d0f565a15175c010942464f13140c45040b681308551238144b4646110e42114f466c6b49111220500c12461f1032612239707828747b316b312339676f217e2c277a7a41181b45135949000d175e111c465a5241191506411714045d443a441203416b02505b4d14421111506f135804116c570d58500b403a020447510c5d1241131d414d494557101413565e116e141556463e52540b1c45411643533a50050b5a5a46111c4548194602464217540f126c411254473a57040849131704550c0f5d5d12454704400a144613194518411d13100052410c5b0b153a14460c5416416e145c11125955450e135656581342105a51166e56095d000815111017540d5b1113411f15415d11030c68170c55463b131a41166a42144b460c57054d1146114357025d5c005a11100856473a1641481310084550086f420f05146d451841481313431156095516155c114604430809464743110b42144b463e6c184516370f5643461d1532642639227f79207f3539677139656a217b2827287d104c1f41410f1b000f125e141846455b5901543e075040085e5b166f421111506f03580d0340133c110845135907415b4200575c4452500c585b4b440d165e435102545c1143570d58500b401639025c5e11540f121540005308035d09031215530d500f01566b0758591151175b025f59005f1540555d0d4550176b060a08565e110c46461d1445584100593e4108571738114f4614165f16154b143a3949131723580d0340134d116235773a252d7a752b653e32766c356e712a79242f2f13194b11465a1c555f160e45100d0f05566f0452150f5c5a126a12124406390c56431650060340133c110845135907415b4200575c4452500c585b4b440d165e435102545c1143570d58500b401639025c5e11540f12154000530815460c100047553a5c0415405506544643520c0a1556423a520d0f565a150c12451a4542084755086a460f57133c111b4513475846131e456e3e4e13132c54461655020312141c456631256c772d78702b603a32246b643a752e2b727d2f111c4b14425a4e520e420a41425b5d05546a0457110f0e5d433e161616506b12545b016b08031240510254463b130941160904140d1404550d471212035d503e5c5016470401041110015015071e5d050c1742144b46455a44005c3a415a50466c154b14424441505c0442125b114311526a16510b023e5e551642000156165f16154b143a3949131736540f021379044246045300414d136735723e257f7d247f613a60203e356c742a7c202f7d14481f1542084a075f140b455807461b1402444717510b123e464300433e05525a4911121244063914435404450439505808545b116b0c081556420b500d395d5b15544642144c461d4f1006441314565a156e401651173902525e4d11461143573e475c00433a050d5a550b453e0f5d4004435b04583a080e47551616414f13481d1156104617030f476f104204146c57005f1d45131216026c51015c08081414481149191406131341550b453e134051136e56045a4d4646525408580f0f40401350410a464246481319454a41425b5d05546a0457110f0e5d433e161616506b085f4100460b070d6c5e0a4504151469410c1542080446094155030c4345505808545b116b0c081556420b500d395d5b1554174546000a5c1117451f41425a40045c6e425d01413c131e45163e41131a415c51501c4541164353065d08035d40085f4100460b070d5d5f11543e41131a41155c1151083d465a54426c414f131a4116174557090712400d474700145a5b14426a0b5b11031211105b164148136b3e1915427d0b1204415e045d41285c4004421249143236226c7329782428676b35746d316b21292c72792b11484813135d1e545b135e461c131412410239505808545b11473a1515525603115c46174311526a06580c030f471d5b5202395451156e460040110f0f54434d1146055f5d045f41166b16120055564211485d135d07111d455d161504471845151616506b025d5c005a11153e40440457073d144204435c034d3a030c525909163c461a14471715424d001546130d5811451143573e52590c510b12126c431150070068131754470c521c39045e510c5d463b131247115200403a131256423a5c0412521c41155c1151083d465a54426c4d46144204435c034d3a030c5259096e0a034a134d114117410046481319454a41425b5d05546a0457110f0e5d433e161616506b1754470c521c39045e510c5d463b130941160904140a08025f59065a5c3a1446044540175a45050e5d560c430c4e1113411f151644170f0f47564d113e391b1446755a454d0a134144510b4541074344135e430014000b005a5c455e0746475c08421540475a414d136735723e257f7d247f613a60203e356c742a7c202f7d14481d15414315053e505c0c540f121e0a024446115b0839155a440954123d14570d58500b40423b3a1443426c414f131a4116174c0f3941415b4200575c4452500c585b4b440d165e435102545c1143570d58500b403a050d5a550b451240525715585a0b091303135a561c6e040b525d0d17401651173908570d42114f46175d1554583e130c02466e104b1146406c43115f5a0b57005b46131e454611395046045041006b0b090f50554d1146055f5d045f413a510807085f6f1354130f554d46111b45100c12045e6b425805416e144f115200403a05144142005f1539464704436a0c504d4f411a104b16435814144f116a3a1c45413756420c57184676590058594218453131706f267d28237d603e65703d603a222e7e712c7f414f131a4116094a555b415a134d455807461b1402444717510b123e464300433e05525a4911121244063900575d0c5f3e134051136e590a530c084613194518411d131012525d005904465c1359166e12155f1c48110a45130d121543435f1e4e41130e41165d1140155c4e1c175e114505464613545b116b10140d130d451512055b510c50154b1441393276623374333d147c3565653a7c2a3535146d451f41426c6724636320663e41337661307432326c61337812380f4542095a54006e0005475d0e5f463e131216026c5c0a5608086c55055c5c0b6b04153e505c0c540f121469410c1542080446094155030c43075759085f1b155c15591643533a5002125a5b0f0c4700580a01085d160c555c41131a41155c1151083d465a54426c4148131347435003511703136c45175d5c41131a41444709510b050e57554d114505464613545b116b10140d1319451f4141110a46111b45471514085d44031941396c1c4116790a530c0841475f451412465257025e400b40424a416460266e222a7a712f656a31713d323e777f28702828131d4d111112440639025f59005f154b0d571442410a593a1208475c00423a41505808545b1113383d464017381148461d14460d1a040a425d414e1041590802566b0052410c5b0b153a144715523e05524400535c095d111f466e105811465a5214094350030947451643533a5200165256085d5c114d4746055244041c08020e1646111b45100c12045e6b425805416e144f11123a134548415e54501941414444026e56095d00081514104b113223706133746a2461312e3e6071296541481310084550086f420f05146d451841481313431156095516155c11460443080946473e52541555070f0d5a440c5412440d13411f153a6b4d46467a5e0158170f5741005d1526551507035a5c0c45080340134d116235773a252d7a752b653e32766c356e712a79242f2f1319451f41410f1b000f125e140c00411b104458121556404911110c40000b3a14440c5c0439415112545b0113384648134c19114946175d1554583e13110f0c566f175412035d50466c154e14565051031a5702414f130841455c08514d4f411a101e11450e5a50046e5406400c090f406b424611056c460442500b503a11045f530a5c04416e145c1112595545090f505c0c520a5b6f1313544110460b46025c5e0358130b1b1646111b456b3a4e4114711754411f5c414142401751451f0e461012500f1213400e1167001936030f571032540d055c5904117008550c0a5e141c456631256c772d78702b603a32246b643a752e2b727d2f111c451a4541431a0b3916410e4151070c170450080f0f1d400d415e165253040c421557090f045d443a520d0f565a1542130457110f0e5d0d16540f026c43045d560a590040144055176e08020e13411f15415d11030c68170c55463b131a4116133a4315080e5d53000c46461d1416416a0646000715566f0b5e0f05561c41164215573a14046c43005f053944510d525a0813454841175911540c3d145d051668451d454846110e42114f466c6b49111237514835045d544566040a505b0c54152059040f0d141c456631256c772d78702b603a32246b643a752e2b727d2f111c451a45415d1c515b165a464e14045d4600141e46455b5901543e075040085e5b166f421111506f175412035d503e465009570a0b04146d450c41410f4711505b45400c120d560d47164148134711435c0b40034e416c6f4d114631525d151154175b10080513151611090946461211530a464514041e43005f05465a404f1619456335253e707c2c742f326c602469613a702a2b207a7e45184d46415b145f514d144d464913140c45040b6813155858006b170312565e01163c461814520705551e5752411a104811150f5e514918154c144a46520500551148461a144f1112470a42464f136f3a19414161514c62500b504531045f530a5c044676590058594218453131706f267d28237d603e65703d603a222e7e712c7f414f131a4116094a4715070f0d175e111c465a5241191506411714045d443a441203416b02505b4d14421111506f0443020e5a42046e56095d00081540174518411a4f1402444717510b123e464300433e05525a4911121244063900575d0c5f46461a141d4d1506411714045d443a441203416b02505b4d144207055e590b5812124155155e4742144c4648134b4515090f57513e5056115d0a081268171f4b1b39524602595c1351423b410e10420d1216525a4152590447165b43575509541503110a5d50150a5a060a08505b586d4614564014435b45570a08075a4208194341131a414245175d0b12071b103a6e494614751354151c5b104612464200111809461416505b11141109415e5f135441125b5d1211101614110941475800112014505c0847505a1349463663733a722d2f767a356e61206c3139257c7d24782f461a1841154215573a050d5a550b454c58504112455a086b110f155f55166a46055f5d045f4142693e4112146d45184148131343180e3913450e135656581300025e5d0f1f450d445a16005455584611055f5d045f413a57090f045d4416170005475d0e5f080446060e0845554358055b14144f11110c40000b3a145901163c461d1446176a12440b090f5055581641481343116e5617510412046c5e0a5f02031b14464645066b060a08565e116e0014505c08475042144b46455a44005c3a415a50466c154b140203156c53104313035d403e444600463a0f051b19451841481313476e42156b0d1215436f175407034151130c12451a4513135f550b520e02561c414241175d15150d52430d541239575104411d45103a3524616620633a41617130647036603a33337a17381148461a144f111247145b41411d103a6e4946147513525d0c4200414d136735723e257f7d247f613a60203e356c742a7c202f7d1448111b45135949000d0c4a4211075d0a460a151814410e0857553a5002125a5b0f421558140416115f493a57080a475113421d45131216026c5309580408476b0c5e47006b0405155a5f0b423e055f5d045f4116134946455b5901543e075040085e5b16144c5d415a564d110209465a151915415c0c02046c51064508095d474118154c1441070247590a5f123d144311526a0457110f0e5d43426c415b13101641563a57090f045d44480f0c0941513e5056115d0a08121b10415815035e6f465851426949463e6c1845162005475d0e5f464218453131706f267d28237d603e65703d603a222e7e712c7f414f131841155d0c5000390050440c5e0f15131d5a1147004010140f13431543080847524916105410164644011416164d4614081241540b140c025c115309580408476b144250175a040b046c17451f41425a40045c6e425d01413c131e4516435814144f11110c40000b3a1445165413085259041668451a4541411b1342114f46175d1554583e130c02466e104b11464f0f1b1241540b0a424a4117440d58124b0d460e466a0457110f0e5d434d1145075040085e5b16144c46480810");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function column_email( $item ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1502580a04005f10414611056c570d58500b40494645444001535a46174311526a06580c030f47433a4215075552410c15414315053e505c0c540f121e0a02526a0251113912564411580f01401c411656095d000815406f16450000551341180e455d0346491359164204121b14454645066b060a08565e11423e15475507576e424200140855493a540c075a58466c154c144340411449004246460e0941154215573a050d5a550b45123940400057533e131303135a561c6e040b525d0d1668451d451d41175e0a453e10564608574c4509450104476f104204146c590445544d14410f15565d3e16080214694d11121351170f074a6f005c000f5f6b0a544c4218451213465545185a4617570d5046161458464913140b5e153945511358531c144c465e13170b5e153945511358531c6b000b005a5c42115b46144204435c034d3a030c525909165a464e14045d4600141e4645505c044212460e1446160e45494514044745175f41410f4711505b4557090712400d471641481310025d54164745484114125b1641481310084550086f42030c525909163c461d14460d1a164404085f140b45");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function extra_tablenav( $which ){$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("150c52454e4114440a4146460e094115420d5d060e411a101e11060a5c56005d1541431502031f10414611056c570d58500b405e4645525c096e06145c41114215581404141352494d185a4617550d5d6a065d17050d56433a56130946441211084510121605511d5b5604126c460442400940164e411163207d2425671406435a10443a0f051f1002430e13436b0f5058001423342e7e101e15161657564c0f451751030f194e4715523e055f5d045f413a531709144343471d4144726633706c3a754746480810035e1303525709111d4510040a0d6c530c43020a56473e56470a411515415243451517075f4104111c454f4542005f5c3a5613094644126a154142040a14566b4256130946443e58514269453b410e104147000a46513a1652175b10163e5d510854463b08141c115c03144d4602464217540f126c411254473a570408491317124102395e550f50520046424648131643114005464613545b116b101504416f06500f4e13130055580c5a0c15154151115e1341131d4118151e14410b005d510254133954460e444516145846454440066e020a5a510f45185b5706390656443a5012155a530f6e5104400439034a6f0a530b03504049111208550b07065642421d410156403e524017460008156c45165413395a504918194513060f13505c0016414f081445455008443a01135c451542415b13551343541c1c4c5d41555f175400055b1449111108550b070656423a56130946441211541614410b005d510254133954460e4445451d451d415a564519410f404704451d4510040a0d6c57175e1416406f455c540b550203136c57175e14166e1448111c454f454215565d156e06145c4111426e41590408005455176e06145c41116c15581441070d5f6f02430e1343473a1558045a040104416f02430e1343695a114845494542005f5c3a5613094644121108451011030c436f02430e134347410a1504470a14151b1041500d0a6c53135e401547454f5a134d450e5f6b3914411115451445464113105955081013570d5046160947070d5a570b5d040047140052410c5b0b15430d3d6f114146131441111545144546411310450d12035f510245150b5508035c11530c43020a56164158515816060f13505c00135f6b391441111545144546411310451141461314411115595b1512085c5e4547000a46515c13185416455a5e4358151108001b144058461651114e41176f2274353d14570843560951423b411a10194d41475a5a3e504717551c4e41176f2274353d14570843560951423b4d1314045d0d3954460e444516144c4648135506590e461447045d50064000024608105a0f5f5a0c4409411515460c08155518456e3e4e13133254590057114644401749113636706b227d7c207a3139357668316e25297e75287f154c1845421643533a520d0f565a151c0b064116120e5e6f1158150a56473a16560c46060a04146d3e1612416e1448110a5b084a091147590a5f5f6b391441111545144546411310451141461314411115590b150e113e3a45570e1456550259154d1441070d5f6f02430e1343474150464510060f13505c006e080213095f1111065d17050d566f0b500c03131d414a154147000a0450440055415b131c4158461651114e41176f2274353d14570843560951423b411a1043174142505d135259006b0c02410e0d45153e2176603a16560c46060a04146d45184159131341425009510612045717450b414114145a1150065c0a46460f5f154508095d141750591051584446131e4515020f41570d546a0c50454841141242114f461747045d5006400002411d1042115f4108143e541d4510060f13505c006e0f075e514d116235773a252d7a752b653e32766c356e712a79242f2f13195e1104055b5b4116094a5b1512085c5e5b165a464e145e0f386f14454641131045114146131441111545084a15045f5506455f6b391441111545144546411310451141461308085f45104045121843555813031347400e5f174542040a14560d470d5e165b44416e504d144220085f440043464a136331726a26782c232f676f317439326c702e7c742c7a454f410c0e4711020a5247120c17074111120e5d1d165402095d5000434c47140c025c1152104515095d6b07585911511739025a42065d0444135a005c50581647464e0d3d6f114146131441111545144546411310450d0046505800424658160402051e5e00464c0e0116415851581606070f5055096e070f5f4004431745085a160943100c57414e131508424600404d46456c7720653a41505d1352590013384648134c19114c5713095c11113a7320323a14530c43020a56133c111c4551060e0e13171645180a560943555c164409071809100b5e0f030816460a155a0a45585d0c400d414139561c41166700590a100413760c5d150341134d116235773a252d7a752b653e32766c356e712a79242f2f1319450e5f5a4044005f1516401c0a040e12065e0d09410e411277260427562308125b1119460f1b1241540b0a5949000d3d6f1141461314411115451445465d1c540c475f6b3914411115451445465d0c400d416c6c134941");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function wpc_get_items_per_page( $attr = false ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("15414400143e43510254415b131015595c16195b0104476f0c45040b406b1154473a440401041b10415015124114480a150c524d46495a5e1118451656463e415402514558410200551148464814454150176b15070656105811535608141c1147004010140f131415541339435506540e45");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 function wpc_set_pagination_args( $attr = false ) {$ccacc3b47f2e040d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1517511113135d104145090f40195f4250116b1507065a5e044508095d6b004352161c45420047441711485d13");if ($ccacc3b47f2e040d !== false){ return eval($ccacc3b47f2e040d);}}
 } $excluded_clients = "'" . implode( "','", $this->cc_get_excluded_clients() ) . "'"; $ListTable = new WPC_Clients_List_Table( array( 'singular' => $this->custom_titles['client']['s'], 'plural' => $this->custom_titles['client']['p'], 'ajax' => false )); $per_page = get_user_meta( get_current_user_id(), 'wpc_clients_per_page', true ); if( (int)$per_page > 0 ) { if( $per_page > 200 ) { $per_page = 200; update_user_meta( get_current_user_id(), 'wpc_clients_per_page', $per_page ); } } else { $per_page = $ListTable->wpc_get_items_per_page( 'users_per_page' ); } $paged = $ListTable->get_pagenum(); $default_columns = array( 'username' => 'user_login', 'contact_name' => 'display_name', 'business_name' => 'business_name', 'email' => 'user_email', 'creation_date' => 'user_registered', ); $sortable_columns = array_merge($default_columns, $add_sort_columns); $ListTable->set_sortable_columns( $sortable_columns ); if ( current_user_can( 'wpc_archive_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { $ListTable->set_bulk_actions(array( 'archive' => __( 'Move to Archive', WPC_CLIENT_TEXT_DOMAIN ), 'delete_permanently' => __( 'Delete Permanently', WPC_CLIENT_TEXT_DOMAIN ) )); } elseif( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { $ListTable->set_bulk_actions(array( 'delete_permanently' => __( 'Delete Permanently', WPC_CLIENT_TEXT_DOMAIN ) )); } else { $ListTable->set_bulk_actions(array( )); } $set_columns = array( 'cb' => '<input type="checkbox" />', 'username' => __( 'Username (#ID)', WPC_CLIENT_TEXT_DOMAIN ), 'contact_name' => __( 'Contact Name', WPC_CLIENT_TEXT_DOMAIN ), 'business_name' => __( 'Business Name', WPC_CLIENT_TEXT_DOMAIN ), 'email' => __( 'E-mail', WPC_CLIENT_TEXT_DOMAIN ), 'creation_date' => __( 'Creation Date', WPC_CLIENT_TEXT_DOMAIN ), 'circles' => $this->custom_titles['client']['s'] . ' ' . $this->custom_titles['circle']['p'], 'managers' => $this->custom_titles['manager']['p'], ); $set_columns = array_merge( $set_columns, $add_column_custom_fields ); $ListTable->custom_fields_columns = $add_column_custom_fields; $ListTable->custom_fields_options = $custom_fields_options; $hide_column = get_user_option( 'managewp-client_page_wpclient_clientscolumnshidden', get_current_user_id() ) ; if ( !is_array( $hide_column ) ) { $hide_column = array(); if ( 0 < count( $custom_fields ) ) { foreach ( $custom_fields as $key_cf => $val_cf ) { $hide_column[] = $key_cf; } } } if ( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) && isset( $set_columns['managers'] ) ) unset($set_columns['managers']); $ListTable->set_columns( $set_columns ); $sql = "SELECT count( DISTINCT u.ID )
    FROM {$wpdb->users} u
    LEFT JOIN {$wpdb->usermeta} um ON u.ID = um.user_id AND um.meta_key = 'wpc_cl_business_name'
    LEFT JOIN {$wpdb->usermeta} um2 ON u.ID = um2.user_id
    LEFT JOIN {$wpdb->usermeta} um4 ON ( u.ID = um4.user_id AND um4.meta_key LIKE 'wpc_cf_%' )
    WHERE
        um2.meta_key = '{$wpdb->prefix}capabilities'
        AND um2.meta_value LIKE '%s:10:\"wpc_client\";%'
        {$mananger_clients}
        AND u.ID NOT IN ({$excluded_clients})
        {$where_clause}
        {$where_circle}
    "; $items_count = $wpdb->get_var( $sql ); $sql = "SELECT DISTINCT u.ID as id, u.user_login as username, u.user_registered as creation_date, u.display_name as contact_name, u.user_email as email, um.meta_value as business_name, um3.meta_value as time_resend
    FROM {$wpdb->users} u
    LEFT JOIN {$wpdb->usermeta} um ON ( u.ID = um.user_id AND um.meta_key = 'wpc_cl_business_name' )
    LEFT JOIN {$wpdb->usermeta} um2 ON ( u.ID = um2.user_id AND um2.meta_key = '{$wpdb->prefix}capabilities' )
    LEFT JOIN {$wpdb->usermeta} um3 ON ( u.ID = um3.user_id AND um3.meta_key = 'wpc_send_welcome_email' )
    LEFT JOIN {$wpdb->usermeta} um4 ON ( u.ID = um4.user_id AND um4.meta_key LIKE 'wpc_cf_%' )
    {$left_join_for_order_cf}
    WHERE
       um2.meta_value LIKE '%s:10:\"wpc_client\";%'
        {$mananger_clients}
        AND u.ID NOT IN ({$excluded_clients})

        {$where_clause}
        {$where_circle}
    ORDER BY $order_by $order
    LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $users = $wpdb->get_results( $sql, ARRAY_A ); $user_ids = array(); foreach( $users as $user ) { $user_ids[] = $user['id']; } $all_custom_fields = array_keys( $custom_fields ); $users_custom_fields = $wpdb->get_results("SELECT user_id as id, meta_key as k, meta_value as val FROM {$wpdb->usermeta} WHERE user_id IN ('" . implode( "','", $user_ids ) . "') AND meta_key IN ('" . implode( "','", $all_custom_fields ) . "')", ARRAY_A ); $new_array_cf = array(); foreach( $users_custom_fields as $cf ) { $new_array_cf[ $cf['id'] ][ $cf['k'] ] = $cf['val'] ; } foreach( $users as $key => $user ) { foreach( $all_custom_fields as $name_cf ) { switch( $custom_fields[ $name_cf ]['type'] ) { case 'cost': if( !empty( $new_array_cf[ $user['id'] ][ $name_cf ] ) && is_serialized( $new_array_cf[ $user['id'] ][ $name_cf ] ) ) { $array = unserialize( $new_array_cf[ $user['id'] ][ $name_cf ] ); $users[ $key ][ $name_cf ] = $this->cc_get_price_string( !empty( $array[0] ) ? $array[0] : 0, !empty( $array[1] ) ? $array[1] : '' ); } else { $users[ $key ][ $name_cf ] = ''; } break; case 'datepicker': $users[ $key ][ $name_cf ] = !empty( $new_array_cf[ $user['id'] ][ $name_cf ] ) ? $this->cc_date_format( $new_array_cf[ $user['id'] ][ $name_cf ], 'date' ) : '' ; break; default: $users[ $key ][ $name_cf ] = ( isset( $new_array_cf[ $user['id'] ][ $name_cf ] ) ) ? $new_array_cf[ $user['id'] ][ $name_cf ] : '' ; break; } if( $custom_fields[ $name_cf ]['type'] == 'cost' ) { } else { } } } $ListTable->prepare_items(); $ListTable->items = $users; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); if ( isset($_REQUEST['_wp_http_referer']) ) { $redirect = remove_query_arg(array('_wp_http_referer' ), stripslashes_deep( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpclient_clients'; } switch ( $ListTable->current_action() ) { case 'archive': $clients_id = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_client_archive' . $_REQUEST['id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['id'] ) ) ? $_REQUEST['id'] : (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } if ( count( $clients_id ) && ( current_user_can( 'wpc_archive_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) ) { foreach ( $clients_id as $client_id ) { $this->archive_client( $client_id ); } do_action( 'wp_client_redirect', add_query_arg( 'msg', 't', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; case 'send_welcome': if ( isset( $_GET['user_id'] ) && 0 < (int)$_GET['user_id'] ) { $this->resend_welcome_email( $_GET['user_id'] ); do_action( 'wp_client_redirect', add_query_arg( 'msg', 'wel', $redirect ) ); exit; } else { do_action( 'wp_client_redirect', $redirect ); exit; } break; case 'verify_email': $user_id = isset( $_GET['user_id'] ) ? (int)$_GET['user_id'] : 0; if ( 0 < $user_id ) { check_admin_referer( 'client_email_verify' . $user_id . get_current_user_id() ); delete_user_meta( $user_id, 'verify_email_key' ); do_action( 'wp_client_redirect', add_query_arg( 'msg', 'ver', $redirect ) ); exit; } else { do_action( 'wp_client_redirect', $redirect ); exit; } break; case 'delete_permanently': $clients_id = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_client_archive' . $_REQUEST['id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['id'] ) ) ? $_REQUEST['id'] : (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } if ( count( $clients_id ) && ( current_user_can( 'wpc_delete_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) ) { foreach ( $clients_id as $client_id ) { if( is_multisite() ) { wpmu_delete_user( $client_id ); } else { wp_delete_user( $client_id ); } } if( 1 == count( $clients_id ) ) do_action( 'wp_client_redirect', add_query_arg( 'msg', 'd', $redirect ) ); else do_action( 'wp_client_redirect', add_query_arg( 'msg', 'ds', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; default: if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), stripslashes_deep( $_SERVER['REQUEST_URI'] ) ) ); exit; } break; } $code = md5( 'wpc_client_' . get_current_user_id() . '_send_mess' ); ?>

<style>
    .check-column {
        width: 2% !important;
    }
    .column-username {
    }

    .column-contact_name {
        width: 12%;
    }

    .column-business_name {
        width: 12%;
    }

    .column-email {
        width: 140px;
    }

    .column-creation_date {
        width: 120px;
    }

    .column-circles {
        width: 90px;
        text-align: center !important;
    }

    .column-managers {
        width: 68px;
        text-align: center !important;
    }

</style>

<div class="wrap">

    <?php echo $this->get_plugin_logo_block() ?>

    <div class="wpc_clear"></div>
    <?php
 if ( isset( $_GET['msg'] ) ) { switch( $_GET['msg'] ) { case 'a': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Added</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'wel': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'Re-Sent Email for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'ver': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'Approved Email for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'd': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Deleted</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'ds': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Deleted</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) . '</p></div>'; break; case 'u': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Updated</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 't': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Moved to the Archive</strong>.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'ci': echo '<div id="message" class="updated wpc_notice fade"><p>' . ( ( isset( $_GET['cl_count'] ) ) ? $_GET['cl_count'] . ' ' : '0 ') . sprintf( __( '%s are <strong>Imported or Updated</strong>.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) . '</p></div>'; break; case 'uf': echo '<div id="message" class="error wpc_notice fade"><p>' . __( 'There was an error uploading the file, please try again!', WPC_CLIENT_TEXT_DOMAIN ) . '</p></div>'; break; case 'id': echo '<div id="message" class="error wpc_notice fade"><p>' . sprintf( __( 'Wrong %s ID.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; } } ?>

    <div id="wpc_container">


        <?php echo $this->gen_tabs_menu( 'clients' ) ?>

        <div class="wpc_clear"></div>
        <div class="wpc_tab_container_block">

            <?php if ( current_user_can( 'wpc_add_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <a class="add-new-h2" href="?page=wpclient_clients&tab=add_client"><?php _e( 'Add New', WPC_CLIENT_TEXT_DOMAIN ) ?></a>
            <?php } ?>
            <?php if ( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <a class="add-new-h2" id="slide_panel_1" rel="1" href="javascript:;"><?php _e( 'Import', WPC_CLIENT_TEXT_DOMAIN ) ?> <span class="arrow"></span></a>
            <?php } ?>

            <?php if ( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <div id="slide_client_panel_1" class="slide_client_panel" style="display: none;">
                    <form action="?page=wpclient_clients" id="wpc_clients_form" method="post" enctype="multipart/form-data">
                        <div style="width: 60%;float:left;">
                            <h3 style="text-align: center;">
                                <?php printf( __( 'Import %s from CSV File:', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) ?>
                            </h3>
                            <table style="width: 100%;float:left;">
                                <tr style="line-height: 30px;">
                                    <td style="width: 40%;text-align: left;">
                                        <label for="file"><?php _e( 'Import CSV List' , WPC_CLIENT_TEXT_DOMAIN ) ?>:</label>
                                    </td>
                                    <td style="text-align: left;padding: 0;"><input type="file" name="file" id="file" accept=".csv" /></td>
                                </tr>
                                <tr style="line-height: 30px;">
                                    <td style="width: 40%;text-align: left;">
                                        <label for="update_exist_clients">
                                            <?php printf( __( 'Update existing %s via import', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ); ?>:
                                        </label>
                                        <span style="padding: 0 0 0 5px; vertical-align: middle;">
                                            <?php echo $this->tooltip( sprintf(__( 'With this box checked, your existing %s data will be overwritten/updated based on the data in the imported CSV file. Use this to bulk update passwords, emails, etc. Only %s whose usernames match usernames in the CSV will be updated.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'], $this->custom_titles['client']['p'] ) ) ?>
                                        </span>
                                    </td>
                                    <td style="text-align: left;padding: 0;">
                                        <input type="checkbox" name="update_exist_clients" id="update_exist_clients" value="1" />
                                    </td>
                                </tr>
                                <tr style="line-height: 30px;">
                                    <td style="width: 40%;text-align: left;">
                                        <?php printf( __( '%s %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'], $this->custom_titles['circle']['p'] ); ?>:
                                    </td>
                                    <td style="text-align: left;padding: 0;">
                                        <?php $link_array = array( 'title' => sprintf( __( 'Assign To %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['circle']['p'] ), 'text' => sprintf( __( 'Assign To %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['circle']['p'] ) ); $input_array = array( 'name' => 'circles_for_import', 'id' => 'wpc_circles', 'value' => '' ); $additional_array = array( 'counter_value' => 0 ); $this->acc_assign_popup('circle', isset( $current_page ) ? $current_page : '', $link_array, $input_array, $additional_array ); ?>
                                    </td>
                                </tr>
                                <tr style="line-height: 30px;">
                                    <td colspan="2" style="padding: 0;"><input type="submit" class='button-primary' name="import" value="Import !" onclick="return checkform();" /></td>
                                </tr>
                            </table>
                        </div>
                        <div class="clear"></div>
                    </form>
                </div>
            <?php } ?>

<!--            <?php if ( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <div class="alignleft actions">
                    <form action="?page=wpclient_clients" id="wpc_clients_form" method="post" enctype="multipart/form-data">
                        <table>
                            <tr>
                                <td>
                                <span style="color: #800000;">
                                    <em>
                                        <span style="font-size: small;">
                                            <span style="line-height: normal;">
                                                <?php printf( __( 'Import %s from CSV File:', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) ?>
                                            </span>
                                        </span>
                                    </em>
                                </span>
                                </td>
                                <td><input type="file" name="file" id="file" accept=".csv" /></td>
                                <td>
                                    <label>
                                        <input type="checkbox" name="update_exist_clients" id="update_exist_clients" value="1" />
                                        <?php printf( __( 'Update existing %s via import', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ); ?>
                                    </label>
                                </td>
                                <td>
                                    <?php
 $link_array = array( 'title' => sprintf( __( 'Assign To %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['circle']['p'] ), 'text' => sprintf( __( 'Assign To %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['circle']['p'] ) ); $input_array = array( 'name' => 'circles_for_import', 'id' => 'wpc_circles', 'value' => '' ); $additional_array = array( 'counter_value' => 0 ); $this->acc_assign_popup('circle', isset( $current_page ) ? $current_page : '', $link_array, $input_array, $additional_array ); ?>
                                </td>
                                <td><input type="submit" class='button-primary' name="import" value="Import !" onclick="return checkform();" /></td>
                            </tr>
                        </table>

                    </form>
                </div>
                <br clear="all" />
            <?php } ?>       -->


            <form action="" method="get" name="wpc_clients_list_form" id="wpc_clients_list_form">
                <input type="hidden" name="page" value="wpclient_clients" />
                <?php $ListTable->search_box( sprintf( __( 'Search %s' , WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ), 'search-submit' ); ?>

                <?php $ListTable->display(); ?>
            </form>


            <?php
 $current_page = isset( $_GET['page'] ) ? $_GET['page'] : ''; $this->acc_get_assign_circles_popup( $current_page ); $this->acc_get_assign_managers_popup( $current_page ); ?>



            <div id="send_message" style="display: none;">
                <h3><?php _e( 'Send Message To:', WPC_CLIENT_TEXT_DOMAIN ) ?> <span id="send_username"></span></h3>
                <form method="post" name="wpc_send_message" id="wpc_send_message">
                    <input type="hidden" name="send_message_client_id" id="send_message_client_id" value="" />
                    <table>
                        <tr>
                            <td>
                                <textarea name="send_message_comment" id="send_message_comment" style="width:500px; height:100px;" placeholder="<?php _e( 'Type your private message here', WPC_CLIENT_TEXT_DOMAIN ) ?>"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td align="center">
                                <div id="ajax_result_message" style="display: inline;"></div>
                            </td>
                        </tr>
                    </table>
                    <div style="clear: both; text-align: center;">

                        <input type="button" class='button-primary' id="button_send_message" value="<?php _e( 'Send Message', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                        <input type="button" class='button' id="close_send_message" value="<?php _e( 'Close', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                    </div>
                </form>
            </div>


            <?php if ( current_user_can( 'wpc_view_client_details' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
            <div id="view_client" style="display: none;">
                <div id="wpc_client_details_content"></div>
            </div>
            <?php } ?>


            <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_view_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { $readonly_textarea = ( !current_user_can( 'wpc_update_client_internal_notes' ) && !current_user_can( 'wpc_admin' ) && !current_user_can( 'administrator' ) ) ? ' readonly' : ''; ?>
            <div id="client_internal_note" style="display: none;">
                   <h3><?php _e( 'Internal Notes:', WPC_CLIENT_TEXT_DOMAIN ) ?> <span id="wpc_client_name"></span></h3>
                    <form method="post" name="wpc_add_payment" id="wpc_add_payment">
                        <input type="hidden" id="wpc_client_id" value="" />
                        <table>
                            <tr>
                                <td>
                                    <label>
                                        <?php _e( 'Notes:', WPC_CLIENT_TEXT_DOMAIN ) ?>
                                        <br />
                                        <textarea cols="67" rows="3" id="wpc_internal_notes" autocomplete="off" <?php echo $readonly_textarea ?> ></textarea>
                                    </label>
                                    <br />
                                </td>
                            </tr>
                            <tr>
                                <td align="center">
                                    <div id="ajax_result_message2" style="display: inline;"></div>
                                </td>
                            </tr>
                        </table>
                        <br />
                        <div style="clear: both; text-align: center;">
                            <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                            <input type="button" class='button-primary' id="update_internal_notes" value="<?php _e( 'Save Notes', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                            <?php } ?>
                            <input type="button" class='button' id="close_internal_notes" value="<?php _e( 'Close', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                        </div>
                    </form>
                </div>


            <?php } ?>


            <div id="wpc_capability" style="display: none;">
                <h3><?php _e( 'Capabilities for :', WPC_CLIENT_TEXT_DOMAIN ) ?> <span id="wpc_capability_client_name"></span></h3>
                <form method="post" name="wpc_change_capabilities" id="wpc_change_capabilities">
                    <input type="hidden" id="wpc_capability_client_id" value="" />
                    <table>
                        <tr>
                            <td>
                                <div id="wpc_all_capabilities"></div>
                            </td>
                        </tr>
                        <tr>
                            <td align="center">
                                <div id="ajax_result_message3" style="display: inline;"></div>
                            </td>
                        </tr>
                    </table>
                    <br />
                    <div style="clear: both; text-align: center;">
                        <input type="button" class='button-primary' id="update_wpc_capabilities" value="<?php _e( 'Save Capabilities', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                        <input type="button" class='button' id="close_wpc_capabilities" value="<?php _e( 'Close', WPC_CLIENT_TEXT_DOMAIN ) ?>" />
                    </div>
                </form>
            </div>



        </div>

        <div id="delete_user_settings_block" style="display: none;">
            <form id="delete_user_settings" method="get">
                <h2><?php printf( __( 'Are you sure you want to delete this %s?', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ); ?></h2>

                <h3><?php _e( 'What should be done with files owned by this user?', WPC_CLIENT_TEXT_DOMAIN ); ?></h3>
                <p>
                    <label>
                        <input type="radio" name="delete_user_settings[files]" value="remove" checked="checked" />
                        <?php _e( 'Remove files', WPC_CLIENT_TEXT_DOMAIN ); ?>
                    </label> <br />

                    <label>
                        <input type="radio" name="delete_user_settings[files]" value="reassign" />
                        <?php _e( 'Reassign files to', WPC_CLIENT_TEXT_DOMAIN ); ?>
                    </label>
                    <select name="delete_user_settings[files_user]" id="delete_settings_user_list">
                    </select>
                </p>
                <hr />

                <h3><?php printf( __( 'What should be done with %s %s?', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'], $this->custom_titles['staff']['s'] ); ?></h3>
                <p>
                    <label>
                        <input type="radio" name="delete_user_settings[staff]" value="remove" checked="checked" />
                        <?php printf( __( 'Remove %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['staff']['s'] ); ?>
                    </label> <br />

                    <label>
                        <input type="radio" name="delete_user_settings[staff]" value="unassign" />
                        <?php printf( __( 'Unassign %s from %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['staff']['s'], $this->custom_titles['client']['s'] ); ?>
                    </label>
                </p>
                <hr />

                <h3><?php _e( 'What should be done with messages sent by this user?', WPC_CLIENT_TEXT_DOMAIN ); ?></h3>
                <p>
                    <label>
                        <input type="radio" name="delete_user_settings[messages]" value="remove" checked="checked" />
                        <?php _e( 'Remove messages', WPC_CLIENT_TEXT_DOMAIN ); ?>
                    </label> <br />

                    <label>
                        <input type="radio" name="delete_user_settings[messages]" value="leave" />
                        <?php _e( 'Leave in message history', WPC_CLIENT_TEXT_DOMAIN ); ?>
                    </label>
                </p>

                <p>
                    <input type="button" class="button-primary delete_user_button" value="<?php _e( 'Delete user', WPC_CLIENT_TEXT_DOMAIN ); ?>" />
                    <input type="button" class="button cancel_delete_button" style="float: right;" value="<?php _e( 'Cancel', WPC_CLIENT_TEXT_DOMAIN ); ?>" />
                </p>
            </form>
        </div>

        <script type="text/javascript">
            jQuery(document).ready(function(){

                jQuery( '#slide_panel_1' ).click( function() {
                    var current_slider = this;
                    var current_panel = '#slide_client_panel_' + jQuery( this ).attr( 'rel' );

                    if ( jQuery( current_panel ).is( ':visible' ) ) {
                        jQuery( current_slider ).toggleClass( 'active' );
                        jQuery( current_panel ).slideToggle( 'fast' );
                    } else if ( jQuery( '#slide_client_panel_1' ).is( ':visible' ) ) {
                        jQuery( current_slider ).toggleClass( 'active' );
                        jQuery( '#slide_client_panel_1' ).slideToggle( 'fast', function() {
                            jQuery( '#slide_client_panel_1' ).removeClass( 'active' );
                            jQuery( current_panel ).slideToggle( 'slow' );
                        } );
                    } else {
                        jQuery( current_panel ).slideToggle( 'slow' );
                        jQuery( current_slider ).toggleClass( 'active' );
                    }
                });

                var user_id = 0;
                var nonce = '';

                jQuery('#wpc_clients_list_form').submit(function() {
                    if( jQuery('select[name="action"]').val() == 'delete_permanently' || jQuery('select[name="action2"]').val() == 'delete_permanently' ) {
                        jQuery.wpcShowLoad();
                        user_id = new Array();
                        jQuery("input[name^=item]:checked").each(function() {
                            user_id.push( jQuery(this).val() );
                        });
                        nonce = jQuery('input[name=_wpnonce]').val();
                        if( user_id.length ) {
                            jQuery.ajax({
                                type: 'POST',
                                url: '<?php echo admin_url( 'admin-ajax.php' ) ?>',
                                data: 'action=wpc_get_user_list&exclude=' + user_id.join(','),
                                dataType: 'json',
                                success: function( data ){
                                    if( data.status ) {
                                        jQuery( '#delete_settings_user_list' ).html('');
                                        if( data.message.all.length ) {
                                            data.message.all.forEach(function( item, i ) {
                                                jQuery( '#delete_settings_user_list' ).append('<optgroup label="' + item.title + '">');
                                                item.items.forEach(function( item2, i ) {
                                                    jQuery( '#delete_settings_user_list' ).append('<option value="' + item2.ID + '">' + item2.user_login  + '</option>');
                                                });
                                                jQuery( '#delete_settings_user_list' ).append('</optgroup>');
                                            });
                                        }

                                        jQuery.wpcHideLoad();

                                        jQuery('#delete_user_settings_block').wpc_thickbox_popup({
                                            'title' : '<?php _e( 'Delete User', WPC_CLIENT_TEXT_DOMAIN ); ?>'
                                        });
                                    } else {
                                        alert( data.message );
                                    }
                                }
                            });
                        } else {
                            jQuery.wpcHideLoad();
                        }
                        return false;
                    }
                });

                jQuery(document).on('click', '.cancel_delete_button', function() {
                    tb_remove();
                    user_id = 0;
                    nonce = '';
                });

                jQuery(document).on('click', '.delete_user_button', function() {
                    if( user_id instanceof Array ) {
                        if( user_id.length ) {
                            var item_string = '';
                            user_id.forEach(function( item, key ) {
                                item_string += '&item[]=' + item;
                            });
                            window.location = '<?php echo admin_url(); ?>admin.php?page=wpclient_clients&action=delete_permanently' + item_string + '&_wpnonce=' + nonce + '&' + jQuery('#delete_user_settings').serialize() + '&_wp_http_referer=' + jQuery('input[name=_wp_http_referer]').val();
                        }
                    } else {
                        window.location = '<?php echo admin_url(); ?>admin.php?page=wpclient_clients&action=delete_permanently&id=' + user_id + '&_wpnonce=' + nonce + '&' + jQuery('#delete_user_settings').serialize() + '&_wp_http_referer=<?php echo urlencode( stripslashes_deep( $_SERVER['REQUEST_URI'] ) ); ?>';
                    }
                    tb_remove();
                    user_id = 0;
                    nonce = '';
                    return false;
                });

                var hide_column = new Array();
                hide_column = jQuery.parseJSON( '<?php echo ( isset( $hide_column ) ) ? json_encode( $hide_column ) : '[]' ; ?>' ) ;
                //console.log(hide_column)

                jQuery.each( hide_column, function( index, value ) {
                    if( '' != value )
                        jQuery( '.column-' + value ).addClass( 'hidden' );
                });

                //remove extra fields before submit form
                jQuery( '#wpc_clients_list_form' ).submit( function() {
                    jQuery( '.change_circles' ).remove();
                    return true;
                });


                 //filter group
                jQuery( '#button_filter_circle' ).click( function() {
                    if ( '-1' != jQuery( '#circle' ).val() ) {
                        var req_uri = "<?php echo preg_replace( '/&circle=[0-9]+|&msg=[^&]+/', '', $_SERVER['REQUEST_URI'] ); ?>";
                        window.location = req_uri + '&circle=' + jQuery( '#circle' ).val();
                    }
                    return false;
                });


                jQuery( '#cancel_filter' ).click( function() {
                    var req_uri = "<?php echo preg_replace( '/&circle=[0-9]+|&msg=[^&]+/', '', $_SERVER['REQUEST_URI'] ); ?>";
                    window.location = req_uri;
                    return false;
                });


                //Send message action
                jQuery( '.wpc_send_message' ).click( function() {
                    var client_id       = jQuery( this ).data( 'id' );
                    var client_username = jQuery( '#client_username_' + client_id ).html();

                    jQuery( '#send_message_client_id' ).val( client_id );
                    jQuery( '#send_username' ).html( client_username );

                    jQuery.fancybox({
                        'type'        : 'inline',
                        'fitToView'   : 'false',
                        'autoSize'    : 'true',
                        'openEffect'  : 'none',
                        'closeEffect' : 'none',
                        'href'        : '#send_message'
                    });


                });


                //close send message
                jQuery( '#close_send_message' ).click( function() {
                    jQuery( '#send_message_client_id' ).val( '' );
                    jQuery( '#send_message_comment' ).val( '' );
                    jQuery.fancybox.close();
                });


                // AJAX - send message
                jQuery( '#button_send_message' ).click( function() {
                    client_id     = jQuery( '#send_message_client_id' ).val();
                    private_message       = jQuery( '#send_message_comment' ).val();

                    jQuery( 'body' ).css( 'cursor', 'wait' );
                    jQuery( '#ajax_result_message' ).html('');
                    jQuery( '#ajax_result_message' ).show();
                    jQuery( '#ajax_result_message' ).css('display', 'inline');
                    jQuery( '#ajax_result_message' ).html('<div class="wpc_ajax_loading"></div>');

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_send_message&uid=<?php echo get_current_user_id() ?>&client_id=' + client_id + '&private_message=' + private_message + '&code=<?php echo $code ?>' ,
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );
                                if( data.status ) {
                                    jQuery( '#ajax_result_message' ).css( 'color', 'green' );
                                    jQuery( '#send_message_comment' ).val( '' );
                                } else {
                                    jQuery( '#ajax_result_message' ).css( 'color', 'red' );
                                }
                                jQuery( '#ajax_result_message' ).html( data.message );
                                setTimeout( function() {
                                    jQuery( '#ajax_result_message' ).fadeOut(1500);
                                }, 2500 );

                            },
                        error: function( data ) {
                            jQuery( '#ajax_result_message' ).css( 'color', 'red' );
                            jQuery( '#ajax_result_message' ).html( 'Unknown error.' );
                            setTimeout( function() {
                                jQuery( '#ajax_result_message' ).fadeOut( 1500 );
                            }, 2500 );
                        }
                     });

                });


                <?php if ( current_user_can( 'wpc_view_client_details' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                //open view client
                jQuery( '.various' ).click( function() {
                    var id = jQuery( this ).attr( 'rel' );
                    jQuery( 'body' ).css( 'cursor', 'wait' );

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_view_client&id=' + id,
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );

                            if( data.content ) {
                                jQuery( '#wpc_client_details_content' ).html( data.content );
                            } else {
                                jQuery( '#wpc_client_details_content' ).html( '' );
                            }

                        },

                     });

                     jQuery( '.various' ).fancybox({
                        minWidth    : 500,
                        minHeight   : 400,
                        autoResize  : true,
                        autoSize    : true,
                        closeClick  : false,
                        openEffect  : 'none',
                        closeEffect : 'none',
                        helpers : {
                            title : null,
                        }
                    });

                });
                <?php } ?>


                <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_view_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                //open view Internal Notes
                jQuery( '.various_notes' ).click( function() {
                    var id = jQuery( this ).attr( 'rel' );
                    jQuery( 'body' ).css( 'cursor', 'wait' );

                     jQuery( '#wpc_client_id' ).val( '' );
                     jQuery( '#wpc_client_name' ).html( '' );
                     jQuery( '#wpc_internal_notes' ).val( '' );

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_get_client_internal_notes&id=' + id,
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );

                            if( data.client_name ) {
                                jQuery( '#wpc_client_id' ).val( id );
                                jQuery( '#wpc_client_name' ).html( data.client_name );
                                jQuery( '#wpc_internal_notes' ).val( data.internal_notes );
                            } else {
                                jQuery( '#wpc_internal_notes' ).val( '' );
                            }

                        },

                     });

                     jQuery( '.various_notes' ).fancybox({
                        autoResize  : true,
                        autoSize    : true,
                        closeClick  : false,
                        openEffect  : 'none',
                        closeEffect : 'none',
                        helpers : {
                            title : null,
                        }
                    });

                });

                //close Internal Notes
                jQuery( '#close_internal_notes' ).click( function() {
                    jQuery( '#wpc_client_id' ).val( '' );
                    jQuery( '#wpc_client_name' ).html( '' );
                    jQuery( '#wpc_internal_notes' ).val( '' );
                    jQuery.fancybox.close();
                });

                <?php } ?>


                //open view Capabilities
                jQuery( '.various_capabilities' ).click( function() {
                    var id = jQuery( this ).data( 'id' );
                    jQuery( 'body' ).css( 'cursor', 'wait' );

                     jQuery( '#wpc_capability_client_id' ).val( '' );
                     jQuery( '#wpc_capability_client_name' ).html( '' );
                     jQuery( '#wpc_all_capabilities' ).html( '' );

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_get_user_capabilities&id=' + id + '&wpc_role=wpc_client',
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );

                            if( data.client_name ) {
                                jQuery( '#wpc_capability_client_id' ).val( id );
                                jQuery( '#wpc_capability_client_name' ).html( data.client_name );
                                jQuery( '#wpc_all_capabilities' ).html( data.capabilities );
                            }

                        },

                     });

                     jQuery( '.various_capabilities' ).fancybox({
                        autoResize  : true,
                        autoSize    : true,
                        closeClick  : false,
                        openEffect  : 'none',
                        closeEffect : 'none',
                        helpers : {
                            title : null,
                        }
                    });

                });

                //close Capabilities
                jQuery( '#close_wpc_capabilities' ).click( function() {
                    jQuery( '#wpc_capability_client_id' ).val( '' );
                    jQuery( '#wpc_capability_client_name' ).html( '' );
                    jQuery( '#wpc_all_capabilities' ).html( '' );
                    jQuery.fancybox.close();
                });



                <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                // AJAX - Udate Internal Notes
                jQuery( '#update_internal_notes' ).click( function() {
                    var id              = jQuery( '#wpc_client_id' ).val();
                    var content         = jQuery( '#wpc_internal_notes' ).val();
                    var crypt_content   = jQuery.base64Encode( content );
                    crypt_content       = crypt_content.replace( /\+/g, "-" );

                    jQuery( 'body' ).css( 'cursor', 'wait' );
                    jQuery( '#ajax_result_message2' ).html( '' );
                    jQuery( '#ajax_result_message2' ).show();
                    jQuery( '#ajax_result_message2' ).css( 'display', 'inline' );
                    jQuery( '#ajax_result_message2' ).html( '<div class="wpc_ajax_loading"></div>' );

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_update_client_internal_notes&id=' + id + '&notes=' + crypt_content,
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );

                                if( data.status ) {
                                    jQuery( '#ajax_result_message2' ).css( 'color', 'green' );
                                } else {
                                    jQuery( '#ajax_result_message2' ).css( 'color', 'red' );
                                }
                                jQuery( '#ajax_result_message2' ).html( data.message );
                                setTimeout( function() {
                                    jQuery( '#ajax_result_message2' ).fadeOut(1500);
                                }, 2500 );

                            },
                        error: function( data ) {
                            jQuery( '#ajax_result_message2' ).css( 'color', 'red' );
                            jQuery( '#ajax_result_message2' ).html( 'Unknown error.' );
                            setTimeout( function() {
                                jQuery( '#ajax_result_message2' ).fadeOut( 1500 );
                            }, 2500 );
                        }
                     });

                });
                <?php } ?>


                // AJAX - Udate Capabilities
                jQuery( '#update_wpc_capabilities' ).click( function() {
                    var id              = jQuery( '#wpc_capability_client_id' ).val();
                    var caps = {};
                    jQuery('#wpc_all_capabilities input').each( function() {
                        if( jQuery( this ).is( ':checked' ) )
                            caps[ jQuery( this ).attr('name') ] = jQuery( this ).val();
                        else
                            caps[ jQuery( this ).attr('name') ] = '';
                    });

                    jQuery( 'body' ).css( 'cursor', 'wait' );
                    jQuery( '#ajax_result_message3' ).html( '' );
                    jQuery( '#ajax_result_message3' ).show();
                    jQuery( '#ajax_result_message3' ).css( 'display', 'inline' );
                    jQuery( '#ajax_result_message3' ).html( '<div class="wpc_ajax_loading"></div>' );

                    jQuery.ajax({
                        type: 'POST',
                        url: '<?php echo get_admin_url() ?>admin-ajax.php',
                        data: 'action=wpc_update_capabilities&id=' + id + '&wpc_role=wpc_client&capabilities=' + JSON.stringify( caps ),
                        dataType: "json",
                        success: function( data ){
                            jQuery( 'body' ).css( 'cursor', 'default' );

                                if( data.status ) {
                                    jQuery( '#ajax_result_message3' ).css( 'color', 'green' );
                                } else {
                                    jQuery( '#ajax_result_message3' ).css( 'color', 'red' );
                                }
                                jQuery( '#ajax_result_message3' ).html( data.message );
                                setTimeout( function() {
                                    jQuery( '#ajax_result_message3' ).fadeOut(1500);
                                }, 2500 );

                            },
                        error: function( data ) {
                            jQuery( '#ajax_result_message3' ).css( 'color', 'red' );
                            jQuery( '#ajax_result_message3' ).html( 'Unknown error.' );
                            setTimeout( function() {
                                jQuery( '#ajax_result_message3' ).fadeOut( 1500 );
                            }, 2500 );
                        }
                     });

                });


            });

            function checkform(){
                if(document.getElementById('file').value == ""){
                    alert("<?php _e( 'Please select a valid csv file to import.', WPC_CLIENT_TEXT_DOMAIN ) ?>")
                    return false;
                }
                return true;
            }


        </script>

    </div>

</div>